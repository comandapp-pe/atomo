<div class="container">
  <%= render 'application/header' %>
  <main>
    <!--    <p id="notice"><%#= notice %></p>-->

    <h1>Productos</h1>

    <!--    <div class="container mt-3 mb-3">-->
    <%#= link_to 'New Template', new_product_path, class: 'btn btn-primary' %>
    <!--    </div>-->

    <div class="container">
      <div class="row g-2">
        <% @products.each do |product| %>
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card ">
              <img
                src="<%= product.thumbnail_url_with_play_button %>"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#modal-<%= product.checkout_code %>"
              >
              <div class="card-body">
                <%= link_to 'Comprar', new_order_path(params: { product_id: product.id }), class: 'btn btn-outline-primary w-100' %>
              </div>
            </div>

            <div class="modal fade" id="modal-<%= product.checkout_code %>" data-product="<%= product.checkout_code %>" tabindex="-1" aria-labelledby="modal" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title"><%= product.checkout_code %></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="ratio ratio-16x9">
                      <%= product.preview_html.html_safe %>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <%= link_to 'Comprar', new_order_path(params: { product_id: product.id }), class: 'btn btn-primary' %>
                  </div>
                </div>
              </div>
            </div>
            <script>
              document.getElementById('modal-<%= product.checkout_code %>').addEventListener('hidden.bs.modal', (event) => {
                  const { product } = event.target.dataset

                  const iframe = document.getElementsByTagName('iframe')[0]

                  iframe.src = iframe.src
                }
              )
            </script>
          </div>
        <% end %>
      </div>
    </div>

    <!--<table>-->
    <!--  <thead>-->
    <!--    <tr>-->
    <!--      <th>Name</th>-->
    <!--      <th>Description</th>-->
    <!--      <th colspan="3"></th>-->
    <!--    </tr>-->
    <!--  </thead>-->

    <!--  <tbody>-->
<%# @templates.each do |product| %>
    <!--      <tr>-->
    <!--        <td><%#= product.name %></td>-->
    <!--        <td><%#= product.description %></td>-->
    <!--        <td><%#= link_to 'Show', product %></td>-->
    <!--        <td><%#= link_to 'Edit', edit_template_path(product) %></td>-->
    <!--        <td><%#= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %></td>-->
    <!--      </tr>-->
<%# end %>
    <!--  </tbody>-->
    <!--</table>-->
  </main>
  <%= render 'application/footer' %>
</div>

